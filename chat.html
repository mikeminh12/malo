<!DOCTYPE html>
<html lang="en" class="light">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Malo Messenger</title>
    <link rel="icon" href="data:,">

    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" />

    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#3b82f6",
                        "bg-surface": "#f9fafb",
                        "bg-chat": "#ffffff",
                    },
                    fontFamily: {
                        sans: ["Plus Jakarta Sans", "sans-serif"],
                    },
                },
            },
        };
    </script>

    <style type="text/tailwindcss">
        @layer base {
            body {
                @apply font-sans antialiased text-slate-700;
            }
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #e2e8f0;
            border-radius: 10px;
        }

        .msg {
            @apply p-3.5 rounded-2xl max-w-[75%] mb-3 text-[15px] font-medium leading-relaxed shadow-sm;
        }
        .msg.me {
            @apply bg-gradient-to-br from-blue-500 to-blue-600 text-white self-end rounded-br-none;
        }
        .msg.them {
            @apply bg-white text-slate-700 self-start rounded-bl-none border border-slate-100;
        }
    </style>
</head>

<body class="h-[100dvh] overflow-hidden bg-bg-surface">
    <div class="flex h-full w-full overflow-hidden">

        <!-- SIDEBAR -->
        <aside class="hidden md:flex w-20 lg:w-24 flex-col bg-bg-surface border-r border-slate-100">
            <div class="flex flex-col items-center justify-between h-full py-8">
                <div class="flex flex-col items-center gap-10">
                    <div
                        class="size-12 rounded-2xl bg-gradient-to-br from-blue-600 to-blue-500 flex items-center justify-center text-white shadow-lg">
                        <span class="material-symbols-outlined">chat_bubble</span>
                    </div>
                    <nav class="flex flex-col gap-6 w-full px-2">
                        <div id="navChat"
                            class="group relative flex justify-center p-3 rounded-xl bg-blue-50 text-blue-600 cursor-pointer transition-all">
                            <span class="material-symbols-outlined text-[26px]">chat</span>
                        </div>
                        <div id="navDiscover"
                            class="group relative flex justify-center p-3 rounded-xl text-slate-400 hover:text-blue-600 hover:bg-blue-50 cursor-pointer transition-all">
                            <span class="material-symbols-outlined text-[26px]">explore</span>
                        </div>
                    </nav>
                </div>
                <div id="navAvatar" class="size-10 rounded-2xl bg-slate-200 flex items-center justify-center font-bold">
                    ?
                </div>
            </div>
        </aside>

        <!-- MAIN LIST -->
        <main class="w-full md:w-80 lg:w-[420px] flex flex-col bg-bg-surface border-r border-slate-100">
            <div class="px-6 pt-6 pb-4">
                <h2 class="text-2xl font-extrabold text-slate-800">Malo Chat</h2>
            </div>

            <div id="mainList" class="flex-1 overflow-y-auto px-4 pb-20 md:pb-6 custom-scrollbar"></div>
        </main>

        <!-- CHAT SECTION -->
        <!-- ❗ FIX CHÍNH Ở ĐÂY -->
        <section id="chatSection"
            class="fixed inset-0 md:static flex flex-col bg-bg-chat md:flex-1 h-full transition-transform md:translate-x-0 translate-x-full z-50 md:z-auto">

            <!-- HEADER -->
            <header
                class="shrink-0 h-16 md:h-24 flex items-center px-4 md:px-10 border-b border-slate-100 bg-white gap-3">
                <button id="btnBack"
                    class="md:hidden p-2 -ml-2 text-slate-500 hover:text-blue-600 transition-colors rounded-full hover:bg-slate-50">
                    <span class="material-symbols-outlined">arrow_back</span>
                </button>
                <div class="flex-1 min-w-0">
                    <h3 id="chatTitle" class="text-lg font-bold truncate">Chọn cuộc trò chuyện</h3>
                </div>
                <button id="btnCall" class="hidden text-blue-600 hover:bg-blue-50 p-2 rounded-full transition-colors">
                    <span class="material-symbols-outlined">videocam</span>
                </button>
            </header>

            <!-- PINNED -->
            <div id="pinnedMsg" class="hidden shrink-0 px-6 py-2 bg-yellow-50 border-b border-yellow-100">
                <p class="text-xs font-bold text-yellow-700">Pinned message</p>
            </div>

            <!-- MESSAGES -->
            <!-- ❗ flex-1 + pb-28 để không bị footer đè -->
            <div id="msgBox" class="flex-1 overflow-y-auto px-4 md:px-10 py-6 pb-28 flex flex-col custom-scrollbar">
            </div>

            <!-- TYPING -->
            <div id="typingIndicator" class="shrink-0 px-10 pb-2 text-xs text-slate-400 italic hidden">
                User is typing...
            </div>

            <!-- FOOTER / INPUT -->
            <!-- ❗ shrink-0 để không ảnh hưởng chiều cao -->
            <footer class="shrink-0 px-4 md:px-10 py-4 bg-white border-t border-slate-100">
                <div class="flex items-center gap-3 bg-slate-50 p-2 rounded-full border">
                    <button class="size-10 flex items-center justify-center text-slate-400 hover:text-blue-500">
                        <span class="material-symbols-outlined">mood</span>
                    </button>

                    <input id="txtMsg" type="text" placeholder="Nhập tin nhắn..."
                        class="flex-1 bg-transparent border-none focus:ring-0 px-2 py-2" />

                    <button id="btnSend"
                        class="size-10 bg-primary text-white rounded-full flex items-center justify-center shadow hover:scale-105 active:scale-95 transition">
                        <span class="material-symbols-outlined">send</span>
                    </button>
                </div>
            </footer>
        </section>
    </div>

    <!-- INCOMING CALL MODAL -->
    <div id="incomingCallModal"
        class="hidden fixed inset-0 z-[60] flex items-center justify-center bg-black/60 backdrop-blur-sm">
        <div
            class="bg-white rounded-3xl p-8 text-center shadow-2xl max-w-sm w-full mx-4 animate-in fade-in zoom-in duration-300">
            <div
                class="size-20 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse">
                <span class="material-symbols-outlined text-4xl">videocam</span>
            </div>
            <h3 class="text-xl font-bold text-slate-800 mb-1">Incoming Call</h3>
            <p id="callerName" class="text-slate-500 mb-8">User is calling...</p>

            <div class="flex justify-center gap-6">
                <button id="btnDeclineCall"
                    class="size-14 bg-red-500 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-red-600 transition-transform hover:scale-110">
                    <span class="material-symbols-outlined">call_end</span>
                </button>
                <div class="w-px bg-slate-100"></div>
                <button id="btnAcceptCall"
                    class="size-14 bg-green-500 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-green-600 transition-transform hover:scale-110 animate-bounce">
                    <span class="material-symbols-outlined">call</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ACTIVE CALL MODAL -->
    <div id="callModal" class="hidden fixed inset-0 z-[70] bg-slate-900 flex flex-col">
        <!-- Remote Video (Full Screen) -->
        <video id="remoteVideo" autoplay playsinline class="flex-1 w-full h-full object-cover"></video>

        <!-- Local Video (PIP) -->
        <div
            class="absolute top-4 right-4 w-32 md:w-48 aspect-[3/4] bg-black rounded-2xl overflow-hidden shadow-2xl border-2 border-white/20">
            <video id="localVideo" autoplay playsinline muted class="w-full h-full object-cover"></video>
        </div>

        <!-- Controls -->
        <div class="absolute bottom-10 inset-x-0 flex flex-col items-center gap-4">
            <div id="callStatus"
                class="px-4 py-2 bg-black/50 backdrop-blur rounded-full text-white text-sm font-medium">
                Calling...
            </div>
            <div class="flex items-center gap-6">
                <!-- Mute Buttons could be added here -->
                <button id="btnEndCall"
                    class="size-16 bg-red-600 text-white rounded-full shadow-xl flex items-center justify-center hover:bg-red-700 transition-transform hover:scale-105">
                    <span class="material-symbols-outlined text-3xl">call_end</span>
                </button>
            </div>
        </div>
    </div>

    <!-- MOBILE NAVIGATION -->
    <nav
        class="md:hidden fixed bottom-0 inset-x-0 bg-white border-t border-slate-100 flex justify-around items-center py-3 z-40 pb-[env(safe-area-inset-bottom)]">
        <div id="mobileNavChat"
            class="nav-item flex flex-col items-center gap-1 text-slate-400 hover:text-blue-600 cursor-pointer transition-colors w-16">
            <span class="material-symbols-outlined">chat_bubble</span>
            <span class="text-[10px] font-medium">Tin nhắn</span>
        </div>
        <div id="mobileNavDiscover"
            class="nav-item flex flex-col items-center gap-1 text-slate-400 hover:text-blue-600 cursor-pointer transition-colors w-16">
            <span class="material-symbols-outlined">explore</span>
            <span class="text-[10px] font-medium">Khám phá</span>
        </div>
        <div id="mobileNavAccount"
            class="nav-item flex flex-col items-center gap-1 text-slate-400 hover:text-blue-600 cursor-pointer transition-colors w-16"
            onclick="window.location.href='account.html'">
            <span class="material-symbols-outlined">person</span>
            <span class="text-[10px] font-medium">Cá nhân</span>
        </div>
    </nav>

    <script type="module" src="js/app.js"></script>
</body>

</html>